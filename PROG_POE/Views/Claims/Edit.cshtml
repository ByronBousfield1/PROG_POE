@model PROG_POE.Models.Claim
@using PROG_POE.Models
@{
    Layout = "_Layout";
}
<div class="row g-3">
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-body">
                <h5 class="card-title">Edit Claim — @Model.Month.ToString("yyyy-MM")</h5>
                <p class="text-muted">Status: <strong>@Model.Status</strong> | Stage: <strong>@Model.Stage</strong></p>

                <form method="post" action="/Claims/AddLine/@Model.ClaimId" class="row g-2">
                    <div class="col-md-4">
                        <label class="form-label">Work Date</label>
                        <input type="date" name="workDate" class="form-control" required />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Hours</label>
                        <input type="number" step="0.25" min="0.25" name="hours" class="form-control" required />
                    </div>
                    <div class="col-md-5">
                        <label class="form-label">Note</label>
                        <input type="text" name="note" class="form-control" />
                    </div>
                    <div class="col-12"><button class="btn btn-outline-primary">Add Line</button></div>
                </form>

                <hr />
                <table class="table">
                    <thead><tr><th>Date</th><th>Hours</th><th>Note</th><th></th></tr></thead>
                    <tbody>
                        @foreach (var l in Model.Lines.OrderBy(l => l.WorkDate))
                        {
                            <tr>
                                <td>@l.WorkDate.ToString("yyyy-MM-dd")</td>
                                <td>@l.Hours</td>
                                <td>@l.Note</td>
                                <td>
                                    <form method="post" action="/Claims/RemoveLine/@Model.ClaimId">
                                        <input type="hidden" name="lineId" value="@l.ClaimLineId" />
                                        <button class="btn btn-sm btn-danger">Remove</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>

                <div class="alert alert-info">Total Hours: <strong>@Model.TotalHours</strong> | Total Amount (R): <strong>@Model.TotalAmount</strong></div>

                <form method="post" action="/Claims/Submit/@Model.ClaimId">
                    <button class="btn btn-success" @(Model.Status != ClaimStatus.Draft ? "disabled" : "")>Submit to Coordinator</button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card shadow mb-3">
            <div class="card-body">
                <h5 class="card-title">Upload Supporting Document</h5>
                <form method="post" enctype="multipart/form-data" action="/Claims/Upload/@Model.ClaimId">
                    <input type="file" class="form-control mb-2" name="file" />
                    <button class="btn btn-outline-secondary">Upload</button>
                </form>
                <ul class="mt-3 list-group">
                    @foreach (var d in Model.Documents.OrderByDescending(d => d.UploadedAt))
                    {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>@d.FileName</span>
                            <a class="btn btn-sm btn-outline-primary" href="/@d.StoredPath" target="_blank">Open</a>
                        </li>
                    }
                </ul>
                <p class="small text-muted mt-2">Allowed: .pdf, .docx, .xlsx — Max 5 MB.</p>
            </div>
        </div>
    </div>
</div>
